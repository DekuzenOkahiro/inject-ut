from mitmproxy import http
import json

def request(flow: http.HTTPFlow):
    print(f"[MITM] Intercepted: {flow.request.method} {flow.request.pretty_url}")
    if "/apiv4r11/auth_key" in flow.request.path:
        flow.response = http.Response.make(
            200,
            json.dumps({
                "data": "209B08559E5B50929B9269AAE6CC6CB33F4CFA6B50BFAC02DE06D03E784BD9BA96D8DEC4334CF5B57E61FB75EA44CF92E8C873523EB370C78CB5FF0B968B7677706BEED36B47054622EECF59E203CF769B3722C874F019EE20D1078CA89035435CEBC8985B252A3B660B0FD503981506EA3DE5181CC7D6DD410C59F08B2379A0A02A0BEC05452457F817D07170F028F0E5DCBDE5D67089FB85BDF747EDA84D7EB59D27370A2562AAC4DC333291C9DD5044249C98C5309DA7589AC8E3EE1E045F548D22085F346FA55CE2A0BBDF9812DB22889FA250A0B54C4C9D47AF9BBD131DA634C952EF54AF72BC7A0DF9DD81D77A0EF1F7D599CDB993DF8BC77CC5FEDF0FF373C32A56341371DD9408541E32F79BA4A8EE21D406B6F6BA94269945CFD085981971C221F606F7C895BF6B8A6CEF5A9316AA1AAE0752F32C9583F495B7ACFB00BDDBF9D313484680A3F51AC0953FD0A248090DA83E68DEB4265AFF0714782010CDE8EC36BD58410BAF897D7A2EC63D082B9CBF83871B809C06291E5C0C0B0EA3DC1F5E2E7C34A0A2EB0D40A06BD4ED0F2B00E7EE4080424239B0F1DB34832E78A59CE3F8348A8943F7EDD28C29C2E62FADA6C0257EE1B4A45DF5F5621773EBC8883A7FBE9A73B0FD344EC6D9D85BD72F4E6034A5FA7D2D589CFD21D55893AB795DC46758EB9148D17EC1B94F3063059022CA6D2405261869C3B3D681EBFE66D539A7E15408F7F64103D209BD37390D244A489FCF40656E5F981D70A4F57BD712C3FF9D3EEB6E11F1D806ABCBC693615ED9133281CA99737E3507B3597315DA"
            }),
            {"Content-Type": "application/json"}
        )
    elif "/apiv4r11/users" in flow.request.path:
        fake_users = [
            {
                "id": 1921438,
                "username": "dinda1",
                "email": "dinda@kuala.shop",
                "avatar": "https://vntool.vn/media/default.png"
            }
        ]
        flow.response = http.Response.make(
            200,
            json.dumps(fake_users),
            {"Content-Type": "application/json"}
        )
