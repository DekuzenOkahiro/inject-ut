from mitmproxy import http
import json

def request(flow: http.HTTPFlow):
    print(f"[MITM] Intercepted: {flow.request.method} {flow.request.pretty_url}")
    if "/apiv4r11/auth_key" in flow.request.path:
        flow.response = http.Response.make(
            200,
            json.dumps({
                "data": "A42B7D8663AABD0B08CAB4A58156DA35F920E184F365929053DACA69A667AAABB7F46D216873865F7777426CB92CE0952F258035E5554AB623627E263B190B38E8DCA143132B242AC1428A7D51BA565092967E6954EFD4FDEEBDCD730DE6F247C929317362CDEFA722BDF8F80872713B28BA4AFBAC44CBAC6C40D8535B2C13C7709F1F38E4CAF18DE9728585C71ED0AAB6D8593A30B4D38E9DA12BBAFD22AC24DAE4986A523209DB0A12BB9B03E654FF612D640ABFFDE68BEF998EF0FCF33E68C0CA1178B02F29D00092754C9ACCEEBFB18BFB88C277393CAB0ADA982916558A078F1D999B9748F53A025BE46F5C99D91EAB1517C892010D7E588BA2D7531C01BB21572F44A5EA345C93B6CFE058F9340E8F3F497F25BDEF258B48568EFF6240943206DE0B980F1A14B0447D5795CE352ED796EA511B36C7C0137A3FC35D77DA83C6DDA79975D59CA1EAE1B28D2F94BB8F1AC6F4917D95D27B1E67BD63042885508FB34905B2F6F1734087D696E6784096B0E2DE99600ADA6DFBE1C207ABA1284398E7B7DAF48946186ED132574D56E8323527F05DEED9590C446237A0ED75F728A3CCD29261513D32EF7C8ABC4A3A989E9B776DE154A094A2FBA2CEE3F25AAA82A11670799540FAC046AFBD168E11DFEDDEF55E501470D8DD0E1E5D9FA147F41394557E1359164815C1774772B197DCDCAB4DF8E6469F4FAEC2DFA08ABC1FC83C23B8584E88ACE6EC5A07485EAE8E3CA00EF1383585099C3004F61DBC98F19DB840BBB618C387878296F74F1CFFE996095A1B1A2CD54EE61981C5750777CF63"
            }),
            {"Content-Type": "application/json"}
        )
    elif "/apiv4r11/users" in flow.request.path:
        fake_users = [
            {
                "id": 2340833,
                "username": "kao0",
                "email": "sunday@oprekyuk.com",
                "avatar": "https://vntool.vn/media/default.png"
            }
        ]
        flow.response = http.Response.make(
            200,
            json.dumps(fake_users),
            {"Content-Type": "application/json"}
        )
