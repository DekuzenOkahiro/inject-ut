from mitmproxy import http
import json

def request(flow: http.HTTPFlow):
    print(f"[MITM] Intercepted: {flow.request.method} {flow.request.pretty_url}")
    if "/apiv4r11/auth_key" in flow.request.path:
        flow.response = http.Response.make(
            200,
            json.dumps({
                "data": "CF306324260692568443C6634E8499A4F59D3447A0CDC9CEC396827EAF17C6039E06A95B9BE360F561F02F46735501BB63C2D4875A46ECAA65558E5D3594F1DDF3543C765B616B8305DD29445704691D8E0AAA7F994D8415D6C0C6C48F938E991E6A2058ADF40E269A64DBB509D32D391D85AB4FF6DE256C6C4B5E1D440E23449A5C5E282E72534889810E280B9E19C957F173720F754D4CADD082316DED6F6F138211F54666F994A26B0BD45A39E37693276822CA20BB6C85B8EDAE46D9F5C7307A1C3B9DB3F90450F876E6BFB49358BA9E788295A841CC808A2D9AA987C6A4173E9EC8468C4F9C74BC2B54E94C14283042AAE17509497B724E8986A1ADF4708DDE4D0D06B5DFE4B5A0F691A0BBCB19A95EC6A75C414A6384D94FDEF63C20D9F57E3C39BF2A4D9FCDF91270D33429D5DC0A5507985127AF1133A90C3D1771D995D2066F026ACCEA2E143D382EE6F2E49AD824A1761AEF0EE17CE147C1B86DFB7D36B774DA87115F8A78646272A5758067AF4F2E74770CDF52B90D2F0B6359F8888A67916C48060DCE32D34B53D8BF47297BEFA8DF9D11CE7AA906899B179290E4B793121DB07FC893D381FA111D410757D6A1B3ACB982FC7EC4EB7C5AA8E051E903F014E285B1CD8785CBBB8C04A481F410526CABC3E3C4B77E065C785AB3123A0C160637E76F9FA3EBB6C80D7E8F0DB75EDB64DFA25D89AB832AE2A0D02B4593DDDFD326E64663513A06B4D82BABF1A647B5826C4A92BF9465F44097BE493B5A85C219BB1D487464CCC8B1CF8DBEA9F73BF7A1DB10E5E14EF8ED2BCC4C780B2CE356F97195FA7BEF0B7742152B48BA"
            }),
            {"Content-Type": "application/json"}
        )
    elif "/apiv4r11/users" in flow.request.path:
        fake_users = [
            {
                "id": 1791127,
                "username": "jagatsukran",
                "email": "jagatsukran@gmail.com",
                "avatar": "https://vntool.vn/media/default.png"
            }
        ]
        flow.response = http.Response.make(
            200,
            json.dumps(fake_users),
            {"Content-Type": "application/json"}
        )
