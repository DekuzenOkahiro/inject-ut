from mitmproxy import http
import json

def request(flow: http.HTTPFlow):
    print(f"[MITM] Intercepted: {flow.request.method} {flow.request.pretty_url}")
    if "/apiv4r11/auth_key" in flow.request.path:
        flow.response = http.Response.make(
            200,
            json.dumps({
                "data": "CBE37CF2DEC7CD9B83FBC2158E47A616CC10DC4000E39EBE15DE3AAFFA364BBB7B7843CD87A7E50AD1360EB5C3C709C62EB88E7EA497978830B93C96D9BEF7E488E14AA548080F980980C50E78754A0E69C8160D38F36E054B221D9ED15207B06B2CD7C9F581DD4D36815381CCB9B1FF6E869614ADCA177A80E1E1717F4876FF81A16E5BF50262A80DFEDFF49DF710FBA2BB242736EE5143CE693C2D1B643054C41C14A08843765E485CC7ACFC5109DAD59BE6E397EE6AA66478743299AD51EC89390E7714C0B6B6912D8AEF124A72BFF4F2B19D67556415ED199273AFF65B5988F407484BCAAFBDB6C37AD829F26E9ABF432B1E7AC730924011A28215314991DBF2A26EC1C01C52BD5BC933FBECFECBBBD815361D2EB75BE563A6837459365871C8C4BA5FBCB75B7449084D3502ED9E4C607D9DE46F39BE48C92D9801FEFB40EFE9080E04700E3345AC7AB62E8D4D04B65A551A83A4421C999BF655BA3FF184750534A36135D5EC5F15C0AEFF10DC5FABA720368B5BA0885FF50FDFC5FE2C33CF8445FF8681216BA31082F0B066ADD7F358EA107C6359F2C17ED8F412B637D14847ED268B7FEA9D20E960B1D0AC10EAFFEB9D9A2C811A3ED1C123E0F924A76E629ACD90AEAFADEBEDDC3D0A365DA9DF263ABF097CC76CB37DC7071877B6383DB0FB27AEF0DFD14A43659BBBEE32C5E274D1DF6D160EBA083BEB4F1B221F8F28C385D8443A3645358A94F85F1AE0BF8BCD0907C1C9469CA593F2F17CC9096DA4B5F4841A32357100242752388BC0031374F0E5C22ECE218C9206D4BC255F8D43"
            }),
            {"Content-Type": "application/json"}
        )
    elif "/apiv4r11/users" in flow.request.path:
        fake_users = [
            {
                "id": 1921438,
                "username": "dinda1",
                "email": "dinda@kuala.shop",
                "avatar": "https://vntool.vn/media/default.png"
            }
        ]
        flow.response = http.Response.make(
            200,
            json.dumps(fake_users),
            {"Content-Type": "application/json"}
        )
